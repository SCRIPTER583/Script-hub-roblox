<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
<title>🔥 Roblox Lua Script Hub 🔥</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin:0;
    background:#1e1e2f;
    color:white;
    overflow-x:hidden;
  }
  header {
    background: rgba(0,0,0,0.7);
    padding: 15px;
    text-align: center;
    font-size: 20px;
    position: relative;
  }
  header button {
    position: absolute;
    right: 10px;
    top: 10px;
    background: #007bff;
    border: none;
    color: white;
    padding: 5px 8px;
    border-radius: 5px;
    cursor: pointer;
  }
  .container {
    padding: 15px;
  }
  input, textarea {
    width: 100%;
    border-radius:8px;
    padding:10px;
    background:#2c2c3a;
    color:white;
    border:none;
    margin-bottom:10px;
    box-sizing:border-box;
  }
  textarea { height:100px; resize:none; }
  button {
    width: 100%;
    padding:10px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    background: rgb(0,123,255);
    color:white;
    font-size:16px;
    margin-bottom:10px;
  }
  .script-list {
    margin-top:20px;
    max-height:400px;
    overflow-y:auto;
  }
  .script-item {
    background: rgba(0,0,0,0.3);
    padding:10px;
    margin-bottom:10px;
    border-radius:6px;
    cursor:pointer;
  }
  .script-item h4 { margin:0 0 5px 0; font-size:16px; }
  pre {
    background: rgba(0,0,0,0.5);
    padding:10px;
    border-radius:6px;
    overflow-x:auto;
    white-space: pre-wrap;  
    word-wrap: break-word;
  }
  .copy-btn, .delete-btn {
    margin-top:5px;
    width: 100%;
    border:none;
    padding:6px;
    border-radius:5px;
    cursor:pointer;
  }
  .copy-btn { background: rgb(40,167,69); color:white; }
  .delete-btn { background: rgb(220,53,69); color:white; }
  .comments { margin-top:15px; }
  .comment { background: rgba(0,0,0,0.3); padding:5px 8px; margin-bottom:5px; border-radius:5px; }
</style>
</head>
<body>
<header>
  🔥 Roblox Lua Script Hub 🔥
  <button id="adminBtn">Admin</button>
</header>
<div class="container">
  <!-- Upload Script -->
  <h4>Upload your script</h4>
  <input type="text" id="scriptTitle" placeholder="Script Title">
  <textarea id="scriptInput" placeholder="Paste your Lua script here..."></textarea>
  <button id="uploadBtn">Upload Script</button>

  <!-- Search -->
  <h4>Search Scripts</h4>
  <input type="text" id="searchInput" placeholder="Search by title..." onkeyup="filterScripts()">

  <!-- Script list -->
  <h4>Available Scripts</h4>
  <div id="scriptList" class="script-list"></div>
</div>

<!-- Script Page Modal -->
<div id="scriptPage" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); color:white; overflow-y:auto; padding:15px; box-sizing:border-box;">
  <button onclick="closeScriptPage()" style="margin-bottom:10px;">⬅ Back</button>
  <h3 id="pageTitle"></h3>
  <pre id="pageContent"></pre>
  <button id="pageCopyBtn" class="copy-btn">Copy Script</button>
  <h4>Comments</h4>
  <div id="commentList" class="comments"></div>
  <textarea id="commentInput" placeholder="Add a comment"></textarea>
  <button id="addCommentBtn">Add Comment</button>
  <button id="deleteScriptBtn" class="delete-btn" style="display:none;">Delete Script</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBSaYjTMcky_ZujbzYUKpdxNaLJr1QyuVs",
  authDomain: "script-hub-roblox.firebaseapp.com",
  projectId: "script-hub-roblox",
  storageBucket: "script-hub-roblox.appspot.com",
  messagingSenderId: "421126428585",
  appId: "1:421126428585:web:bf814c7e1557351a04d6b8",
  measurementId: "G-HQQ03V2QXF"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let allScripts = [];
let isAdmin = false;
let currentScriptId = null;

// Admin Unlock
document.getElementById("adminBtn").onclick = () => {
  const code = prompt("Enter admin code:");
  if(code === "Admin01972"){
    isAdmin = true;
    alert("✅ Admin mode unlocked!");
  } else alert("❌ Wrong code");
};

// Upload Script
document.getElementById("uploadBtn").onclick = async () => {
  const title = document.getElementById("scriptTitle").value.trim();
  const content = document.getElementById("scriptInput").value.trim();
  if(!title || !content) return alert("⚠️ Enter title and script!");
  await addDoc(collection(db,"scripts"),{
    title, content, comments: [], date: new Date().toISOString()
  });
  document.getElementById("scriptTitle").value="";
  document.getElementById("scriptInput").value="";
  loadScripts();
};

// Load Scripts
async function loadScripts(){
  const list = document.getElementById("scriptList");
  list.innerHTML="";
  const q = query(collection(db,"scripts"), orderBy("date","desc"));
  const querySnapshot = await getDocs(q);
  allScripts=[];
  querySnapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const id = docSnap.id;
    allScripts.push({id,...data});
    const div = document.createElement("div");
    div.className="script-item";
    div.innerHTML=`<h4>${data.title}</h4>`;
    div.onclick = ()=>openScriptPage(id);
    list.appendChild(div);
  });
}

// Filter Scripts
window.filterScripts = () => {
  const input = document.getElementById("searchInput").value.toLowerCase();
  document.querySelectorAll(".script-item").forEach((el,i)=>{
    el.style.display = allScripts[i].title.toLowerCase().includes(input) ? "block":"none";
  });
}

// Open Script Page
async function openScriptPage(id){
  currentScriptId = id;
  const script = allScripts.find(s=>s.id===id);
  document.getElementById("scriptPage").style.display="block";
  document.getElementById("pageTitle").textContent=script.title;
  document.getElementById("pageContent").textContent=script.content;
  document.getElementById("pageCopyBtn").onclick = ()=>{navigator.clipboard.writeText(script.content); alert("📋 Copied!");};
  
  // Admin delete button
  const delBtn = document.getElementById("deleteScriptBtn");
  if(isAdmin){ delBtn.style.display="block"; delBtn.onclick=async ()=>{
    await deleteDoc(doc(db,"scripts",id));
    alert("❌ Script deleted!");
    closeScriptPage();
    loadScripts();
  }}
  else delBtn.style.display="none";

  // Load comments
  const commentList = document.getElementById("commentList");
  commentList.innerHTML="";
  if(script.comments) script.comments.forEach(c=>{
    const div = document.createElement("div");
    div.className="comment";
    div.textContent=c;
    commentList.appendChild(div);
  });

  // Add comment
  document.getElementById("addCommentBtn").onclick=async ()=>{
    const text = document.getElementById("commentInput").value.trim();
    if(!text) return;
    await updateDoc(doc(db,"scripts",id),{
      comments: arrayUnion(text)
    });
    document.getElementById("commentInput").value="";
    loadScripts();
    openScriptPage(id);
  }
}

// Close Script Page
window.closeScriptPage = ()=>{
  document.getElementById("scriptPage").style.display="none";
}

loadScripts();
</script>
</body>
</html>
